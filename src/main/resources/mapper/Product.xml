<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tardybird.goodsinfo.mapper.ProductMapper">
    <resultMap id="product" type="com.tardybird.goodsinfo.entity.Product">
        <result property="id" column="id"/>
        <result property="goodsId" column="goods_id"/>
        <result property="productIds" column="product_ids"/>
        <result property="picUrl" column="pic_url"/>
        <result property="specifications" column="specifications"/>
        <result property="price" column="price"/>
        <result property="safetyStock" column="safety_stock"/>
        <result property="gmtCreate" column="gmt_create"/>
        <result property="gmtModified" column="gmt_modified"/>
        <result property="beDeleted" column="id_deleted"/>

    </resultMap>
    <select id="getProductById" resultMap="product">
        select * from product where id=#{id}
    </select>
    
    <select id="getProductByGoodsId" resultMap="product">
        select * from product where goods_id=#{goodsId}
    </select>

    <insert id="createProduct" parameterType="com.tardybird.goodsinfo.entity.Product" useGeneratedKeys="true"
            keyProperty="id">
        insert into product(product_ids, pic_url, specifications, goods_id, price, safety_stock, gmt_create,
                            gmt_modified, is_deleted)
        values (#{productIds}, #{picUrl}, #{specifications}, #{goodsId}, #{price}, #{safetyStock}, current_timestamp ,
                current_timestamp , 0)
    </insert>

    <update id="updateProduct" parameterType="product">
        update product
        <set>
            <if test="productIds != null">
                product_ids=#{productIds}
            </if>
            <if test="picUrl != null">
                pic_url=#{picUrl}
            </if>
            <if test="specifications != null">
                specifications=#{specifications}
            </if>
            <if test="goodsId != null">
                goods_id=#{goodsId}
            </if>
            <if test="price != null">
                price=#{price}
            </if>
            <if test="safetyStock != null">
                safety_stock=#{safetyStock}
            </if>
            <if test="beDeleted != null">
                is_deleted=#{beDeleted}
            </if>
            gmt_modified=now()
        </set>
        where id=#{id}
    </update>

    <update id="deleteProduct" parameterType="com.tardybird.goodsinfo.domain.Product">
        update product
        set is_deleted=1
        where id=#{id}
    </update>

</mapper>